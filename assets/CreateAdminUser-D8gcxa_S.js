import{r as a,j as e,N as u,s as p}from"./index-ON36CVHN.js";import{u as b}from"./auth-DmCimFZ_.js";const y=()=>{const{user:r,profile:s,loadProfile:x}=b(),[i,o]=a.useState(!1),[c,d]=a.useState(""),[l,m]=a.useState(""),[f,g]=a.useState(!1),n="danteovtata@gmail.com";a.useEffect(()=>{r&&s&&s.role!=="admin"&&r.email===n&&d("Your profile exists but needs elevated permissions. Click the button to make yourself an admin.")},[r,s]);const h=async()=>{if(r){o(!0),m("");try{if(r.email!==n)throw new Error("You are not authorized to perform this action");const{error:t}=await p.from("profiles").update({role:"admin"}).eq("id",r.id);if(t)throw t;await x(),g(!0),d("Success! You are now an admin. Redirecting to admin dashboard..."),setTimeout(()=>{window.location.href="/admin"},2e3)}catch(t){console.error("Error making admin:",t),m(t instanceof Error?t.message:"Unknown error occurred")}finally{o(!1)}}};return r?(s==null?void 0:s.role)==="admin"?e.jsx(u,{to:"/admin",replace:!0}):r.email!==n?e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full space-y-8 bg-zinc-900 p-8 rounded-lg border border-zinc-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-serif",children:"Access Denied"}),e.jsx("p",{className:"mt-2 text-gray-400",children:"This page is only accessible to the site administrator."}),e.jsx("a",{href:"/login",className:"mt-6 inline-block bg-zinc-800 text-white px-4 py-2 rounded-md text-sm hover:bg-zinc-700",children:"Back to Login"})]})})}):e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:e.jsx("div",{className:"max-w-md w-full space-y-8 bg-zinc-900 p-8 rounded-lg border border-zinc-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-serif",children:"Admin Setup"}),l&&e.jsx("div",{className:"mt-4 p-3 bg-red-900/20 border border-red-800 rounded text-red-400",children:l}),f?e.jsx("div",{className:"mt-4 p-3 bg-green-900/20 border border-green-800 rounded text-green-400",children:c}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mt-4 text-gray-300",children:c||"This page allows you to set up your admin access."}),e.jsx("button",{onClick:h,disabled:i,className:`mt-6 w-full bg-gold text-black px-4 py-2 rounded-md font-medium ${i?"opacity-50 cursor-not-allowed":"hover:bg-gold/90"}`,children:i?"Processing...":"Make Me Admin"})]})]})})}):e.jsx(u,{to:"/login",replace:!0})};export{y as default};
