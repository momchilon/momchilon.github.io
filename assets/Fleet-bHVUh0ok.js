import{r as d,j as e,s as o}from"./index-vmAuPSp_.js";import{P as A,S as T,T as O}from"./trash-2-DRUyqndY.js";import{C as j}from"./car-D70p8d8B.js";const D=()=>{const[m,y]=d.useState([]),[N,w]=d.useState([]),[v,h]=d.useState(!0),[z,u]=d.useState(!1),[s,i]=d.useState(null),[k,p]=d.useState(!1),x=async()=>{h(!0);try{const{data:t,error:l}=await o.from("vehicles").select("*, vehicle_types(name)").order("make",{ascending:!0});if(l)throw l;y(t||[])}catch(t){console.error("Error fetching vehicles:",t),alert("Error fetching vehicles. Please try again.")}finally{h(!1)}},C=async()=>{try{const{data:t,error:l}=await o.from("vehicle_types").select("*").order("name",{ascending:!0});if(l)throw l;w(t||[])}catch(t){console.error("Error fetching vehicle types:",t)}};d.useEffect(()=>{x(),C()},[]);const b=t=>{i(t||{make:"",model:"",year:new Date().getFullYear(),license_plate:"",vin:"",status:"active",type_id:null,features:{},photos:[]}),u(!0)},f=()=>{u(!1),i(null)},n=t=>{const{name:l,value:a}=t.target;i(c=>c?{...c,[l]:a}:null)},S=t=>{try{const l=JSON.parse(t.target.value);i(a=>a?{...a,features:l}:null)}catch{const a=t.target.value;i(c=>c?{...c,features:a}:null)}},V=t=>{try{const l=JSON.parse(t.target.value);i(a=>a?{...a,photos:l}:null)}catch{const a=t.target.value,c=a.includes(`
`)?a.split(`
`).map(r=>r.trim()).filter(r=>r):a.split(",").map(r=>r.trim()).filter(r=>r);i(r=>r?{...r,photos:c}:null)}},_=async t=>{if(t.preventDefault(),!s)return;const l=!!s.id;try{if(l){const{error:a}=await o.from("vehicles").update(s).eq("id",s.id);if(a)throw a}else{const{error:a}=await o.from("vehicles").insert([s]);if(a)throw a}f(),x()}catch(a){console.error("Error saving vehicle:",a),alert("Error saving vehicle. Please try again.")}},E=async t=>{if(confirm("Are you sure you want to delete this vehicle?")){p(!0);try{const{error:l}=await o.from("vehicles").delete().eq("id",t);if(l)throw l;x()}catch(l){console.error("Error deleting vehicle:",l),alert("Error deleting vehicle. Please try again.")}finally{p(!1)}}},g=t=>{var a;return((a=t.vehicle_types)==null?void 0:a.name)||"Not specified"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Fleet Management"}),e.jsxs("button",{onClick:()=>b(),className:"bg-gold hover:bg-gold/90 text-black px-4 py-2 rounded flex items-center",children:[e.jsx(A,{size:18,className:"mr-2"}),"Add Vehicle"]})]}),e.jsxs("div",{className:"bg-blue-900/20 border border-blue-800 rounded-lg p-4 text-sm",children:[e.jsx("h3",{className:"text-blue-400 font-medium mb-1",children:"Vehicle Types"}),e.jsx("p",{className:"text-gray-300 mb-2",children:"There are two types of vehicles in the system:"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-gray-300",children:[e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400 font-medium",children:"Chauffeur"})," - Vehicles that come with a professional driver. ",e.jsx("span",{className:"text-yellow-400",children:"Only these appear on the main website."})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-blue-400 font-medium",children:"Rental"})," - Self-drive vehicles that are rented without a driver."]})]})]}),v?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-gold"})}):m.length===0?e.jsxs("div",{className:"text-center py-12 bg-zinc-800 rounded-lg",children:[e.jsx(j,{size:48,className:"mx-auto text-zinc-600 mb-4"}),e.jsx("p",{className:"text-zinc-400",children:'No vehicles found. Click "Add Vehicle" to create your first vehicle.'})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-zinc-800 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-zinc-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-300 uppercase tracking-wider",children:"Vehicle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-300 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-300 uppercase tracking-wider",children:"Year"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-zinc-300 uppercase tracking-wider",children:"Daily Rate"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-zinc-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-700",children:m.map(t=>e.jsxs("tr",{className:"hover:bg-zinc-750",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.photos&&t.photos.length>0?e.jsx("img",{src:t.photos[0],alt:`${t.make} ${t.model}`,className:"h-10 w-10 rounded-full object-cover mr-3"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-zinc-600 flex items-center justify-center mr-3",children:e.jsx(j,{size:18,className:"text-zinc-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-white",children:[t.make," ",t.model]}),e.jsx("div",{className:"text-sm text-zinc-400",children:t.license_plate})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                      ${g(t)==="chauffeur"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:g(t)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                      ${t.status==="active"?"bg-green-100 text-green-800":t.status==="maintenance"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-300",children:t.year}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-zinc-300",children:t.daily_rate?`€${t.daily_rate}`:"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>b(t),className:"text-indigo-400 hover:text-indigo-300 mr-3",children:e.jsx(T,{size:18})}),e.jsx("button",{onClick:()=>E(t.id),className:"text-red-400 hover:text-red-300",disabled:k,children:e.jsx(O,{size:18})})]})]},t.id))})]})}),z&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-zinc-800 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:s.id?"Edit Vehicle":"Add New Vehicle"}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Make"}),e.jsx("input",{type:"text",name:"make",value:s.make||"",onChange:n,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Model"}),e.jsx("input",{type:"text",name:"model",value:s.model||"",onChange:n,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Year"}),e.jsx("input",{type:"number",name:"year",value:s.year||new Date().getFullYear(),onChange:n,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Vehicle Type"}),e.jsxs("select",{name:"type_id",value:s.type_id||"",onChange:n,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white",children:[e.jsx("option",{value:"",children:"Select a type"}),N.map(t=>e.jsxs("option",{value:t.id,children:[t.name.charAt(0).toUpperCase()+t.name.slice(1),t.description?` - ${t.description}`:""]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"License Plate"}),e.jsx("input",{type:"text",name:"license_plate",value:s.license_plate||"",onChange:n,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"VIN"}),e.jsx("input",{type:"text",name:"vin",value:s.vin||"",onChange:n,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:s.status||"active",onChange:n,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white",required:!0,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"retired",children:"Retired"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Daily Rate (€)"}),e.jsx("input",{type:"number",name:"daily_rate",value:s.daily_rate||"",onChange:n,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Mileage"}),e.jsx("input",{type:"number",name:"mileage",value:s.mileage||"",onChange:n,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Features (JSON format)"}),e.jsx("textarea",{name:"features",value:s.features?JSON.stringify(s.features,null,2):"{}",onChange:S,rows:4,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-zinc-400 mt-1",children:["Example: ","{'engine': 'V8 biturbo', 'seats': 'Leather', 'audio': 'Premium sound system'}"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Photos (One URL per line)"}),e.jsx("textarea",{name:"photos",value:s.photos?Array.isArray(s.photos)?s.photos.join(`
`):JSON.stringify(s.photos):"",onChange:V,rows:3,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"Notes"}),e.jsx("textarea",{name:"notes",value:s.notes||"",onChange:n,rows:2,className:"w-full bg-zinc-700 border border-zinc-600 rounded px-3 py-2 text-white"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 bg-zinc-700 hover:bg-zinc-600 text-white rounded",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-gold hover:bg-gold/90 text-black rounded",children:s.id?"Update Vehicle":"Add Vehicle"})]})]})]})})})]})};export{D as default};
