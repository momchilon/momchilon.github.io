import{b as u,s as l}from"./index-1NSynUhw.js";const n=u(i=>({user:null,profile:null,isLoading:!0,error:null,signIn:async(e,r)=>{const{data:s,error:o}=await l.auth.signInWithPassword({email:e,password:r});if(o)throw o},signOut:async()=>{const{error:e}=await l.auth.signOut();if(e)throw e;i({user:null,profile:null})},loadProfile:async()=>{var e;i({isLoading:!0,error:null});try{const{data:{user:r}}=await l.auth.getUser();if(r){const{data:s,error:o}=await l.from("profiles").select("id").eq("id",r.id).single();if(o&&o.code!=="PGRST116")throw console.error("Error checking profile:",o),o;if(!s){const{error:t}=await l.from("profiles").insert([{id:r.id,role:"staff",full_name:((e=r.email)==null?void 0:e.split("@")[0])||"User"}]);if(t)throw console.error("Error creating profile:",t),t}const{data:f,error:a}=await l.from("profiles").select("*").eq("id",r.id).single();if(a)throw console.error("Error fetching profile:",a),a;i({user:r,profile:f,isLoading:!1,error:null})}else i({user:null,profile:null,isLoading:!1,error:null})}catch(r){console.error("Error in loadProfile:",r),i({isLoading:!1,error:r instanceof Error?r.message:"Failed to load user profile"})}}}));l.auth.onAuthStateChange((i,e)=>{e!=null&&e.user?n.getState().loadProfile():n.setState({user:null,profile:null,isLoading:!1,error:null})});n.getState().loadProfile();export{n as u};
